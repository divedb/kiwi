\doxysection{iobuf.\+hh}
\hypertarget{iobuf_8hh_source}{}\label{iobuf_8hh_source}\index{include/kiwi/io/iobuf.hh@{include/kiwi/io/iobuf.hh}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *\ Copyright\ (c)\ Meta\ Platforms,\ Inc.\ and\ affiliates.}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *\ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *\ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *\ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ *\ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ *\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ *\ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ *\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ *\ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ *\ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{comment}{//}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ Docs:\ https://fburl.com/fbcref\_iobuf}}
\DoxyCodeLine{00019\ \textcolor{comment}{//}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <glog/logging.h>}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <atomic>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <cassert>}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <cinttypes>}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ <compare>}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ <cstddef>}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ <cstring>}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ <iterator>}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ <limits>}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ <type\_traits>}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#include\ "{}kiwi/common/exception.hh"{}}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#include\ "{}kiwi/common/function\_ref.hh"{}}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#include\ "{}kiwi/common/iterators.hh"{}}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#include\ "{}kiwi/containers/span.hh"{}}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#include\ "{}kiwi/io/uio.hh"{}}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#include\ "{}kiwi/portability/compiler\_specific.hh"{}}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#include\ "{}kiwi/util/checked\_math.hh"{}}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ KIWI\_PUSH\_WARNING}
\DoxyCodeLine{00048\ \textcolor{comment}{//\ Ignore\ shadowing\ warnings\ within\ this\ file,\ so\ includers\ can\ use\ -\/Wshadow.}}
\DoxyCodeLine{00049\ KIWI\_GNU\_DISABLE\_WARNING(\textcolor{stringliteral}{"{}-\/Wshadow"{}})}
\DoxyCodeLine{00050\ \textcolor{comment}{//\ Some\ compilers\ break\ on\ -\/Wdocumentation.\ Not\ all\ compilers\ recognise\ that}}
\DoxyCodeLine{00051\ \textcolor{comment}{//\ option,\ so\ we\ also\ suppress\ -\/Wpragmas}}
\DoxyCodeLine{00052\ KIWI\_GNU\_DISABLE\_WARNING(\textcolor{stringliteral}{"{}-\/Wpragmas"{}})}
\DoxyCodeLine{00053\ \textcolor{comment}{//\ Ignore\ documentation\ warnings,\ to\ enable\ overloads\ to\ share\ documentation}}
\DoxyCodeLine{00054\ \textcolor{comment}{//\ with\ differing\ parameters}}
\DoxyCodeLine{00055\ KIWI\_GNU\_DISABLE\_WARNING(\textcolor{stringliteral}{"{}-\/Wdocumentation"{}})}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ namespace\ \mbox{\hyperlink{namespacekiwi}{kiwi}}\ \{}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \textcolor{keyword}{namespace\ }detail\ \{}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00064\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00065\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structkiwi_1_1detail_1_1_is_unique_ptr_to_s_l}{IsUniquePtrToSL}}\ :\ std::false\_type\ \{\};}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ D>}
\DoxyCodeLine{00068\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structkiwi_1_1detail_1_1_is_unique_ptr_to_s_l}{IsUniquePtrToSL}}<std::unique\_ptr<T,\ D>>\ :\ std::is\_standard\_layout<T>\ \{\};}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \}\ \ \textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00291\ \textcolor{keyword}{class\ }IOBuf\ \{}
\DoxyCodeLine{00292\ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00293\ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classkiwi_1_1_i_o_buf_1_1_iterator}{Iterator}};}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \textcolor{keyword}{enum}\ CreateOp\ \{\ kCreate\ \};}
\DoxyCodeLine{00296\ \ \ \textcolor{keyword}{enum}\ WrapBufferOp\ \{\ kWrapBuffer\ \};}
\DoxyCodeLine{00297\ \ \ \textcolor{keyword}{enum}\ TakeOwnershipOp\ \{\ kTaskeOwnership\ \};}
\DoxyCodeLine{00298\ \ \ \textcolor{keyword}{enum}\ CopyBufferOp\ \{\ kCopyBuffer\ \};}
\DoxyCodeLine{00299\ \ \ \textcolor{keyword}{enum}\ SizedFree\ \{\ kSizedFree\ \};}
\DoxyCodeLine{00300\ \ \ \textcolor{keyword}{enum\ class}\ CombinedOption\ \{\ kDefault,\ kCombined,\ kSeparate\ \};}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \ \ \textcolor{keyword}{using\ }value\_type\ =\ uint8\_t;}
\DoxyCodeLine{00303\ \ \ \textcolor{keyword}{using\ }iterator\ =\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_1_1_iterator}{Iterator}};}
\DoxyCodeLine{00304\ \ \ \textcolor{keyword}{using\ }const\_iterator\ =\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_1_1_iterator}{Iterator}};}
\DoxyCodeLine{00305\ \ \ \textcolor{keyword}{using\ }ByteRange\ =\ \mbox{\hyperlink{classkiwi_1_1span}{kiwi::span<uint8\_t>}};}
\DoxyCodeLine{00306\ \ \ \textcolor{keyword}{using\ }FreeFunction\ =\ void\ (*)(\textcolor{keywordtype}{void}*\ buf,\ \textcolor{keywordtype}{void}*\ user\_data);}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00309\ \ \ \textcolor{keyword}{class\ }DeleterBase\ \{}
\DoxyCodeLine{00310\ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{keyword}{virtual}\ \string~DeleterBase()\ \{\}}
\DoxyCodeLine{00312\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ Dispose(\textcolor{keywordtype}{void}*\ p)\ \textcolor{keyword}{noexcept}\ =\ 0;}
\DoxyCodeLine{00313\ \ \ \};}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ UniquePtr>}
\DoxyCodeLine{00316\ \ \ \textcolor{keyword}{class\ }UniquePtrDeleter\ :\ \textcolor{keyword}{public}\ DeleterBase\ \{}
\DoxyCodeLine{00317\ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00318\ \ \ \ \ \textcolor{keyword}{using\ }Pointer\ =\ \textcolor{keyword}{typename}\ UniquePtr::pointer;}
\DoxyCodeLine{00319\ \ \ \ \ \textcolor{keyword}{using\ }Deleter\ =\ \textcolor{keyword}{typename}\ UniquePtr::deleter\_type;}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00321\ \ \ \ \ \textcolor{keyword}{explicit}\ UniquePtrDeleter(Deleter\ deleter)\ :\ deleter\_(std::move(deleter))\ \{\}}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \ \ \ \ \textcolor{keywordtype}{void}\ Dispose(\textcolor{keywordtype}{void}*\ p)\ \textcolor{keyword}{noexcept}\ \textcolor{keyword}{override}\ \{}
\DoxyCodeLine{00324\ \ \ \ \ \ \ deleter\_(\textcolor{keyword}{static\_cast<}Pointer\textcolor{keyword}{>}(p));}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ \textcolor{keyword}{this};}
\DoxyCodeLine{00326\ \ \ \ \ \}}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00329\ \ \ \ \ Deleter\ deleter\_;}
\DoxyCodeLine{00330\ \ \ \};}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \ \ \textcolor{keyword}{enum}\ FlagsEnum\ :\ uintptr\_t\ \{}
\DoxyCodeLine{00333\ \ \ \ \ \textcolor{comment}{//\ Adding\ any\ more\ flags\ would\ not\ work\ on\ 32-\/bit\ architectures,}}
\DoxyCodeLine{00334\ \ \ \ \ \textcolor{comment}{//\ as\ these\ flags\ are\ stashed\ in\ the\ least\ significant\ 2\ bits\ of\ a}}
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{comment}{//\ max-\/align-\/aligned\ pointer.}}
\DoxyCodeLine{00336\ \ \ \ \ kFlagFreeSharedInfo\ =\ 0x1,}
\DoxyCodeLine{00337\ \ \ \ \ kFlagMask\ =\ (1\ <<\ 2\ \textcolor{comment}{/*\ least\ significant\ bits\ */})\ -\/\ 1,}
\DoxyCodeLine{00338\ \ \ \};}
\DoxyCodeLine{00339\ }
\DoxyCodeLine{00340\ \ \ \textcolor{keyword}{struct\ }SharedInfoObserverEntryBase\ \{}
\DoxyCodeLine{00341\ \ \ \ \ SharedInfoObserverEntryBase*\ prev\{\textcolor{keyword}{this}\};}
\DoxyCodeLine{00342\ \ \ \ \ SharedInfoObserverEntryBase*\ next\{\textcolor{keyword}{this}\};}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{keyword}{virtual}\ \string~SharedInfoObserverEntryBase()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ AfterFreeExtBuffer()\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ =\ 0;}
\DoxyCodeLine{00347\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ AfterReleaseExtBuffer()\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ =\ 0;}
\DoxyCodeLine{00348\ \ \ \};}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Observer>}
\DoxyCodeLine{00351\ \ \ \textcolor{keyword}{struct\ }SharedInfoObserverEntry\ :\ SharedInfoObserverEntryBase\ \{}
\DoxyCodeLine{00352\ \ \ \ \ std::decay\_t<Observer>\ observer;}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ \ \ \ \ \textcolor{keyword}{explicit}\ SharedInfoObserverEntry(Observer\&\&\ obs)\ \textcolor{keyword}{noexcept}(}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \textcolor{keyword}{noexcept}(Observer(std::forward<Observer>(obs))))}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ :\ observer(std::forward<Observer>(obs))\ \{\}}
\DoxyCodeLine{00357\ }
\DoxyCodeLine{00358\ \ \ \ \ \textcolor{keywordtype}{void}\ AfterFreeExtBuffer()\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \textcolor{keyword}{final}\ \{}
\DoxyCodeLine{00359\ \ \ \ \ \ \ observer.AfterFreeExtBuffer();}
\DoxyCodeLine{00360\ \ \ \ \ \}}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00362\ \ \ \ \ \textcolor{keywordtype}{void}\ AfterReleaseExtBuffer()\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \textcolor{keyword}{final}\ \{}
\DoxyCodeLine{00363\ \ \ \ \ \ \ observer.AfterReleaseExtBuffer();}
\DoxyCodeLine{00364\ \ \ \ \ \}}
\DoxyCodeLine{00365\ \ \ \};}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \ \ \textcolor{keyword}{class\ }SharedInfo\ \{}
\DoxyCodeLine{00368\ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00369\ \ \ \ \ \textcolor{keyword}{using\ }ObserverCb\ =\ \mbox{\hyperlink{classkiwi_1_1function__ref}{function\_ref}}<void(SharedInfoObserverEntryBase\&)>;}
\DoxyCodeLine{00370\ }
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ ReleaseStorage(SharedInfo*\ info)\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ InvokeAndDeleteEachObserver(}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ SharedInfoObserverEntryBase*\ observer\_list\_head,}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ ObserverCb\ cb)\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \ \ SharedInfo();}
\DoxyCodeLine{00377\ \ \ \ \ SharedInfo(FreeFunction\ fn,\ \textcolor{keywordtype}{void}*\ arg,\ \textcolor{keywordtype}{bool}\ hfs\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \ \ \textcolor{comment}{//\ A\ pointer\ to\ a\ function\ to\ call\ to\ free\ the\ buffer\ when\ the\ refcount}}
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{comment}{//\ hits\ 0.\ \ If\ this\ is\ null,\ free()\ will\ be\ used\ instead.}}
\DoxyCodeLine{00381\ \ \ \ \ FreeFunction\ free\_fn;}
\DoxyCodeLine{00382\ \ \ \ \ \textcolor{keywordtype}{void}*\ user\_data;}
\DoxyCodeLine{00383\ \ \ \ \ SharedInfoObserverEntryBase*\ observer\_list\_head\{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{00384\ \ \ \ \ std::atomic<uint32\_t>\ refcount;}
\DoxyCodeLine{00385\ \ \ \ \ \textcolor{keywordtype}{bool}\ externally\_shared\{\textcolor{keyword}{false}\};}
\DoxyCodeLine{00386\ \ \ \ \ \textcolor{keywordtype}{bool}\ use\_heap\_full\_storage\{\textcolor{keyword}{false}\};}
\DoxyCodeLine{00387\ \ \ \ \ std::mutex\ observer\_list\_lock;}
\DoxyCodeLine{00388\ \ \ \};}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00391\ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structkiwi_1_1_i_o_buf_1_1_heap_prefix}{HeapPrefix}};}
\DoxyCodeLine{00392\ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structkiwi_1_1_i_o_buf_1_1_heap_storage}{HeapStorage}};}
\DoxyCodeLine{00393\ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structkiwi_1_1_i_o_buf_1_1_heap_full_storage}{HeapFullStorage}};}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00400\ \ \ \textcolor{keyword}{struct\ }InternalConstructor\ \{\};\ \ \textcolor{comment}{//\ avoid\ conflicts}}
\DoxyCodeLine{00401\ }
\DoxyCodeLine{00402\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ FreeUniquePtrBuffer(\textcolor{keywordtype}{void}*\ ptr,\ \textcolor{keywordtype}{void}*\ user\_data)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00403\ \ \ \ \ \textcolor{keyword}{static\_cast<}DeleterBase*\textcolor{keyword}{>}(user\_data)-\/>Dispose(ptr);}
\DoxyCodeLine{00404\ \ \ \}}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ uintptr\_t\ PackFlagsAndSharedInfo(uintptr\_t\ flags,}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ SharedInfo*\ info)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00408\ \ \ \ \ uintptr\_t\ uinfo\ =\ \textcolor{keyword}{reinterpret\_cast<}uintptr\_t\textcolor{keyword}{>}(info);}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00410\ \ \ \ \ DCHECK\_EQ(flags\ \&\ \string~kFlagMask,\ 0u);}
\DoxyCodeLine{00411\ \ \ \ \ DCHECK\_EQ(uinfo\ \&\ kFlagMask,\ 0u);}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \ \ \ \ \textcolor{keywordflow}{return}\ flags\ |\ uinfo;}
\DoxyCodeLine{00414\ \ \ \}}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ \ \ \textcolor{keyword}{inline}\ SharedInfo*\ GetSharedInfo()\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00417\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{reinterpret\_cast<}SharedInfo*\textcolor{keyword}{>}(flags\_and\_shared\_info\_\ \&\ \string~kFlagMask);}
\DoxyCodeLine{00418\ \ \ \}}
\DoxyCodeLine{00419\ }
\DoxyCodeLine{00420\ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ SetSharedInfo(SharedInfo*\ info)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00421\ \ \ \ \ uintptr\_t\ uinfo\ =\ \textcolor{keyword}{reinterpret\_cast<}uintptr\_t\textcolor{keyword}{>}(info);}
\DoxyCodeLine{00422\ }
\DoxyCodeLine{00423\ \ \ \ \ DCHECK\_EQ(uinfo\ \&\ kFlagMask,\ 0u);}
\DoxyCodeLine{00424\ }
\DoxyCodeLine{00425\ \ \ \ \ flags\_and\_shared\_info\_\ =\ (flags\_and\_shared\_info\_\ \&\ kFlagMask)\ |\ uinfo;}
\DoxyCodeLine{00426\ \ \ \}}
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ \ \ \textcolor{keyword}{inline}\ uintptr\_t\ Flags()\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00429\ \ \ \ \ \textcolor{keywordflow}{return}\ flags\_and\_shared\_info\_\ \&\ kFlagMask;}
\DoxyCodeLine{00430\ \ \ \}}
\DoxyCodeLine{00431\ }
\DoxyCodeLine{00432\ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ SetFlags(uintptr\_t\ flags)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00433\ \ \ \ \ DCHECK\_EQ(flags\ \&\ \string~kFlagMask,\ 0u);}
\DoxyCodeLine{00434\ }
\DoxyCodeLine{00435\ \ \ \ \ flags\_and\_shared\_info\_\ |=\ flags;}
\DoxyCodeLine{00436\ \ \ \}}
\DoxyCodeLine{00437\ }
\DoxyCodeLine{00438\ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ ClearFlags(uintptr\_t\ flags)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00439\ \ \ \ \ DCHECK\_EQ(flags\ \&\ \string~kFlagMask,\ 0u);}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00441\ \ \ \ \ flags\_and\_shared\_info\_\ \&=\ \string~flags;}
\DoxyCodeLine{00442\ \ \ \}}
\DoxyCodeLine{00443\ }
\DoxyCodeLine{00444\ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ SetFlagsAndSharedInfo(uintptr\_t\ flags,}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ SharedInfo*\ info)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00446\ \ \ \ \ flags\_and\_shared\_info\_\ =\ PackFlagsAndSharedInfo(flags,\ info);}
\DoxyCodeLine{00447\ \ \ \}}
\DoxyCodeLine{00448\ }
\DoxyCodeLine{00449\ \ \ \textcolor{keyword}{enum\ class}\ TakeOwnershipOption\ \{\ kDefault,\ kStoreSize\ \};}
\DoxyCodeLine{00450\ }
\DoxyCodeLine{00451\ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<IOBuf>\ TakeOwnership(}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ buf,\ std::size\_t\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}},\ std::size\_t\ offset,\ std::size\_t\ length,}
\DoxyCodeLine{00453\ \ \ \ \ \ \ FreeFunction\ free\_fn,\ \textcolor{keywordtype}{void}*\ user\_data,\ \textcolor{keywordtype}{bool}\ free\_on\_error,}
\DoxyCodeLine{00454\ \ \ \ \ \ \ TakeOwnershipOption\ option);}
\DoxyCodeLine{00455\ }
\DoxyCodeLine{00456\ \ \ IOBuf(InternalConstructor,\ uintptr\_t\ flagsAndSharedInfo,\ uint8\_t*\ buf,}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ std::size\_t\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}},\ uint8\_t*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a708944d0de466a93fda5102be9ceb938}{data}},\ std::size\_t\ length)\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{00458\ }
\DoxyCodeLine{00459\ \ \ \textcolor{keywordtype}{void}\ UnshareOneSlow();}
\DoxyCodeLine{00460\ \ \ \textcolor{keywordtype}{void}\ UnshareChained();}
\DoxyCodeLine{00461\ \ \ \textcolor{keywordtype}{void}\ MakeManagedChained();}
\DoxyCodeLine{00462\ \ \ \textcolor{keywordtype}{void}\ CoalesceSlow();}
\DoxyCodeLine{00463\ \ \ \textcolor{keywordtype}{void}\ CoalesceSlow(\textcolor{keywordtype}{size\_t}\ max\_length);}
\DoxyCodeLine{00464\ }
\DoxyCodeLine{00465\ \ \ \textcolor{comment}{//\ newLength\ must\ be\ the\ entire\ length\ of\ the\ buffers\ between\ this\ and}}
\DoxyCodeLine{00466\ \ \ \textcolor{comment}{//\ end\ (no\ truncation)}}
\DoxyCodeLine{00467\ \ \ \textcolor{keywordtype}{void}\ CoalesceAndReallocate(\textcolor{keywordtype}{size\_t}\ new\_head\_room,\ \textcolor{keywordtype}{size\_t}\ new\_length,}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IOBuf*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ad096f4cf2aaac5ee522618ad6dbe9cbc}{end}},\ \textcolor{keywordtype}{size\_t}\ new\_tail\_room);}
\DoxyCodeLine{00469\ \ \ \textcolor{keywordtype}{void}\ CoalesceAndReallocate(\textcolor{keywordtype}{size\_t}\ new\_length,\ IOBuf*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ad096f4cf2aaac5ee522618ad6dbe9cbc}{end}})\ \{}
\DoxyCodeLine{00470\ \ \ \ \ CoalesceAndReallocate(\mbox{\hyperlink{classkiwi_1_1_i_o_buf_a9f9c776ad615d21567b831945c1529d5}{HeadRoom}}(),\ new\_length,\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ad096f4cf2aaac5ee522618ad6dbe9cbc}{end}},\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ad096f4cf2aaac5ee522618ad6dbe9cbc}{end}}-\/>prev\_-\/>TailRoom());}
\DoxyCodeLine{00471\ \ \ \}}
\DoxyCodeLine{00472\ \ \ \textcolor{keywordtype}{void}\ DecrementRefcount()\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{00473\ \ \ \textcolor{keywordtype}{void}\ ReserveSlow(std::size\_t\ min\_head\_room,\ std::size\_t\ min\_tail\_room);}
\DoxyCodeLine{00474\ \ \ \textcolor{keywordtype}{void}\ FreeExtBuffer()\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{00475\ }
\DoxyCodeLine{00476\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{size\_t}\ GoodExtBufferSize(std::size\_t\ min\_capacity);}
\DoxyCodeLine{00477\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ InitExtBuffer(uint8\_t*\ buf,\ \textcolor{keywordtype}{size\_t}\ malloc\_size,}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ SharedInfo**\ info\_return,}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t*\ capacity\_return);}
\DoxyCodeLine{00480\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ AllocExtBuffer(std::size\_t\ min\_capacity,\ uint8\_t**\ buf\_return,}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ SharedInfo**\ info\_return,}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t*\ capacity\_return);}
\DoxyCodeLine{00483\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ ReleaseStorage(\mbox{\hyperlink{structkiwi_1_1_i_o_buf_1_1_heap_storage}{HeapStorage}}*\ storage,}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint16\_t\ free\_flags)\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{00485\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ FreeInternalBuf(\textcolor{keywordtype}{void}*\ buf,\ \textcolor{keywordtype}{void}*\ user\_data)\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00487\ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00491\ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<IOBuf>\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a8e0900f4f9d06d41fa4e7c083217c6a5}{Create}}(std::size\_t\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}});}
\DoxyCodeLine{00492\ }
\DoxyCodeLine{00504\ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<IOBuf>\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a658b91e57a2ba2db9f44f52754816cd0}{CreateCombined}}(std::size\_t\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}});}
\DoxyCodeLine{00505\ }
\DoxyCodeLine{00515\ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<IOBuf>\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a72e3a9dbf354e19f5a944d98d6c02dff}{CreateSeparate}}(std::size\_t\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}});}
\DoxyCodeLine{00516\ }
\DoxyCodeLine{00531\ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<IOBuf>\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a7ec83685834b52dc2abb979c60a041f0}{CreateChain}}(\textcolor{keywordtype}{size\_t}\ total\_capacity,}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ max\_buf\_capacity);}
\DoxyCodeLine{00533\ }
\DoxyCodeLine{00539\ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<IOBuf>\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a607437c3b69268f69e8f9e1bc91732ba}{WrapBuffer}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ buf,}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}});}
\DoxyCodeLine{00541\ }
\DoxyCodeLine{00543\ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<IOBuf>\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a73bd25f5c105b84ef5512ac4563b9dc7}{WrapBuffer}}(ByteRange\ br)\ \{}
\DoxyCodeLine{00544\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a607437c3b69268f69e8f9e1bc91732ba}{WrapBuffer}}(br.data(),\ br.size());}
\DoxyCodeLine{00545\ \ \ \}}
\DoxyCodeLine{00546\ }
\DoxyCodeLine{00551\ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<IOBuf>\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a0021793658b0d2bc1b179710296dcb55}{TakeOwnership}}(\textcolor{keywordtype}{void}*\ buf,\ std::size\_t\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}},}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FreeFunction\ free\_fn\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ user\_data\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ free\_on\_error\ =\ \textcolor{keyword}{true})\ \{}
\DoxyCodeLine{00555\ \ \ \ \ \textcolor{keywordflow}{return}\ TakeOwnership(buf,\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}},\ 0,\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}},\ free\_fn,\ user\_data,}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ free\_on\_error,\ TakeOwnershipOption::kDefault);}
\DoxyCodeLine{00557\ \ \ \}}
\DoxyCodeLine{00558\ }
\DoxyCodeLine{00563\ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<IOBuf>\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_aa4997f43bc6a4087debc998829057614}{TakeOwnership}}(\textcolor{keywordtype}{void}*\ buf,\ std::size\_t\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}},}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ length,}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FreeFunction\ free\_fn\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ user\_data\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ free\_on\_error\ =\ \textcolor{keyword}{true})\ \{}
\DoxyCodeLine{00568\ \ \ \ \ \textcolor{keywordflow}{return}\ TakeOwnership(buf,\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}},\ 0,\ length,\ free\_fn,\ user\_data,}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ free\_on\_error,\ TakeOwnershipOption::kDefault);}
\DoxyCodeLine{00570\ \ \ \}}
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00601\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ UniquePtr>}
\DoxyCodeLine{00602\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{typename}\ std::enable\_if<detail::IsUniquePtrToSL<UniquePtr>::value,}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<IOBuf>>::type}
\DoxyCodeLine{00604\ \ \ TakeOwnership(UniquePtr\&\&\ buf,\ \textcolor{keywordtype}{size\_t}\ count\ =\ 1);}
\DoxyCodeLine{00605\ }
\DoxyCodeLine{00616\ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<IOBuf>\ WrapIov(\textcolor{keyword}{const}\ iovec*\ vec,\ \textcolor{keywordtype}{size\_t}\ count);}
\DoxyCodeLine{00617\ }
\DoxyCodeLine{00633\ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<IOBuf>\ TakeOwnershipIov(\textcolor{keyword}{const}\ iovec*\ vec,\ \textcolor{keywordtype}{size\_t}\ count,}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FreeFunction\ free\_fn\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ user\_data\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ free\_on\_error\ =\ \textcolor{keyword}{true});}
\DoxyCodeLine{00637\ }
\DoxyCodeLine{00645\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}\ WrapBufferAsValue(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ buf,}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ capacity)\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{00647\ }
\DoxyCodeLine{00649\ \ \ \textcolor{keyword}{static}\ IOBuf\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a5bb99bd7abf8d1b185d4fe18a80c44ad}{WrapBufferAsValue}}(ByteRange\ br)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00650\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a64afb5aeb32475087026e7fa44ef37e8}{WrapBufferAsValue}}(br.data(),\ br.size());}
\DoxyCodeLine{00651\ \ \ \}}
\DoxyCodeLine{00652\ }
\DoxyCodeLine{00658\ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<IOBuf>\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a5c9ba80c7ca24ab312bfca2816e184bb}{CopyBuffer}}(ByteRange\ br,}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ head\_room\ =\ 0,}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ min\_tail\_room\ =\ 0)\ \{}
\DoxyCodeLine{00661\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a5c9ba80c7ca24ab312bfca2816e184bb}{CopyBuffer}}(br.data(),\ br.size(),\ head\_room,\ min\_tail\_room);}
\DoxyCodeLine{00662\ \ \ \}}
\DoxyCodeLine{00663\ }
\DoxyCodeLine{00665\ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<IOBuf>\ CopyBuffer(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ buf,\ std::size\_t\ size,}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ head\_room\ =\ 0,}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ min\_tail\_room\ =\ 0);}
\DoxyCodeLine{00668\ }
\DoxyCodeLine{00674\ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<IOBuf>\ CopyBuffer(std::string\_view\ buf,}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ head\_room\ =\ 0,}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ min\_tail\_room\ =\ 0);}
\DoxyCodeLine{00677\ }
\DoxyCodeLine{00683\ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<IOBuf>\ MaybeCopyBuffer(std::string\_view\ buf,}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ head\_room\ =\ 0,}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ min\_tail\_room\ =\ 0);}
\DoxyCodeLine{00686\ }
\DoxyCodeLine{00696\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a98078164d255f6b0773220e8dd498949}{Destroy}}(std::unique\_ptr<IOBuf>\&\&\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a708944d0de466a93fda5102be9ceb938}{data}})\ \{}
\DoxyCodeLine{00697\ \ \ \ \ \textcolor{keyword}{auto}\ destroyer\ =\ std::move(\mbox{\hyperlink{classkiwi_1_1_i_o_buf_a708944d0de466a93fda5102be9ceb938}{data}});}
\DoxyCodeLine{00698\ \ \ \}}
\DoxyCodeLine{00699\ }
\DoxyCodeLine{00720\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{size\_t}\ GoodSize(\textcolor{keywordtype}{size\_t}\ min\_capacity,}
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CombinedOption\ combined\ =\ CombinedOption::kDefault);}
\DoxyCodeLine{00722\ }
\DoxyCodeLine{00733\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}(CreateOp,\ std::size\_t\ capacity);}
\DoxyCodeLine{00734\ }
\DoxyCodeLine{00770\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a0da85cf118a667a0f9267bd3e580c95c}{IOBuf}}(TakeOwnershipOp\ op,\ \textcolor{keywordtype}{void}*\ buf,\ std::size\_t\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}},}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ \ FreeFunction\ free\_fn\ =\ \textcolor{keyword}{nullptr},\ \textcolor{keywordtype}{void}*\ user\_data\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ free\_on\_error\ =\ \textcolor{keyword}{true})}
\DoxyCodeLine{00773\ \ \ \ \ \ \ :\ IOBuf(op,\ buf,\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}},\ 0,\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}},\ free\_fn,\ user\_data,}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ free\_on\_error)\ \{\}}
\DoxyCodeLine{00775\ }
\DoxyCodeLine{00778\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a99e9c470caa96aec01ba4c5a0880d8c1}{IOBuf}}(TakeOwnershipOp\ op,\ \textcolor{keywordtype}{void}*\ buf,\ std::size\_t\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}},\ std::size\_t\ length,}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ FreeFunction\ free\_fn\ =\ \textcolor{keyword}{nullptr},\ \textcolor{keywordtype}{void}*\ user\_data\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ free\_on\_error\ =\ \textcolor{keyword}{true})}
\DoxyCodeLine{00781\ \ \ \ \ \ \ :\ IOBuf(op,\ buf,\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}},\ 0,\ length,\ free\_fn,\ user\_data,\ free\_on\_error)\ \{}
\DoxyCodeLine{00782\ \ \ \}}
\DoxyCodeLine{00783\ }
\DoxyCodeLine{00786\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}(TakeOwnershipOp,\ \textcolor{keywordtype}{void}*\ buf,\ std::size\_t\ capacity,\ std::size\_t\ offset,}
\DoxyCodeLine{00787\ \ \ \ \ \ \ \ \ std::size\_t\ length,\ FreeFunction\ free\_fn\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ user\_data\ =\ \textcolor{keyword}{nullptr},\ \textcolor{keywordtype}{bool}\ free\_on\_error\ =\ \textcolor{keyword}{true});}
\DoxyCodeLine{00789\ }
\DoxyCodeLine{00792\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}(TakeOwnershipOp,\ SizedFree,\ \textcolor{keywordtype}{void}*\ buf,\ std::size\_t\ capacity,}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \ \ std::size\_t\ offset,\ std::size\_t\ length,\ \textcolor{keywordtype}{bool}\ free\_on\_error\ =\ \textcolor{keyword}{true});}
\DoxyCodeLine{00794\ }
\DoxyCodeLine{00800\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a2b84f84ca1454238aa2531223d420a78}{IOBuf}}()\ noexcept;}
\DoxyCodeLine{00801\ }
\DoxyCodeLine{00805\ \ \ IOBuf(const\ IOBuf\&\ other);}
\DoxyCodeLine{00806\ }
\DoxyCodeLine{00817\ \ \ IOBuf(IOBuf\&\&\ other)\ noexcept;}
\DoxyCodeLine{00818\ }
\DoxyCodeLine{00824\ \ \ IOBuf\&\ operator=(IOBuf\&\&\ other)\ noexcept;}
\DoxyCodeLine{00825\ }
\DoxyCodeLine{00830\ \ \ IOBuf\&\ operator=(const\ IOBuf\&\ other);}
\DoxyCodeLine{00831\ }
\DoxyCodeLine{00850\ \ \ IOBuf(WrapBufferOp\ op,\ ByteRange\ br)\ noexcept;}
\DoxyCodeLine{00851\ }
\DoxyCodeLine{00853\ \ \ IOBuf(WrapBufferOp\ op,\ const\ \textcolor{keywordtype}{void}*\ buf,\ std::\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}})\ noexcept;}
\DoxyCodeLine{00854\ }
\DoxyCodeLine{00873\ \ \ IOBuf(CopyBufferOp\ op,\ ByteRange\ br,\ std::\textcolor{keywordtype}{size\_t}\ head\_room\ =\ 0,}
\DoxyCodeLine{00874\ \ \ \ \ \ \ \ \ std::\textcolor{keywordtype}{size\_t}\ min\_tail\_room\ =\ 0);}
\DoxyCodeLine{00875\ }
\DoxyCodeLine{00877\ \ \ IOBuf(CopyBufferOp\ op,\ const\ \textcolor{keywordtype}{void}*\ buf,\ std::\textcolor{keywordtype}{size\_t}\ size,}
\DoxyCodeLine{00878\ \ \ \ \ \ \ \ \ std::\textcolor{keywordtype}{size\_t}\ head\_room\ =\ 0,\ std::\textcolor{keywordtype}{size\_t}\ min\_tail\_room\ =\ 0);}
\DoxyCodeLine{00879\ }
\DoxyCodeLine{00880\ \ \ IOBuf(CopyBufferOp\ op,\ std::string\_view\ buf,\ std::\textcolor{keywordtype}{size\_t}\ headroom\ =\ 0,}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \ \ std::\textcolor{keywordtype}{size\_t}\ minTailroom\ =\ 0)}
\DoxyCodeLine{00882\ \ \ \ \ \ \ :\ IOBuf(op,\ buf.\mbox{\hyperlink{classkiwi_1_1_i_o_buf_a708944d0de466a93fda5102be9ceb938}{data}}(),\ buf.size(),\ headroom,\ minTailroom)\ \{\}}
\DoxyCodeLine{00883\ }
\DoxyCodeLine{00893\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{\string~IOBuf}}();}
\DoxyCodeLine{00894\ }
\DoxyCodeLine{00903\ \ \ \textcolor{keywordtype}{bool}\ empty()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00904\ }
\DoxyCodeLine{00908\ \ \ \textcolor{keyword}{const}\ uint8\_t*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a708944d0de466a93fda5102be9ceb938}{data}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ data\_;\ \}}
\DoxyCodeLine{00909\ }
\DoxyCodeLine{00916\ \ \ uint8\_t*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a05c8383995275986e0534b77a6438a31}{WritableData}}()\ \{\ \textcolor{keywordflow}{return}\ data\_;\ \}}
\DoxyCodeLine{00917\ }
\DoxyCodeLine{00921\ \ \ \textcolor{keyword}{const}\ uint8\_t*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a27b29fcaa18008ff3ba19d93303a4082}{Tail}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ data\_\ +\ length\_;\ \}}
\DoxyCodeLine{00922\ }
\DoxyCodeLine{00929\ \ \ uint8\_t*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a77919d0f48c5fe6895b7fcfa4e48016b}{WritableTail}}()\ \{\ \textcolor{keywordflow}{return}\ data\_\ +\ length\_;\ \}}
\DoxyCodeLine{00930\ }
\DoxyCodeLine{00937\ \ \ std::size\_t\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a73808ff60c3bdbd250e0a4dbf556dd45}{Length}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ length\_;\ \}}
\DoxyCodeLine{00938\ }
\DoxyCodeLine{00944\ \ \ std::size\_t\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a9f9c776ad615d21567b831945c1529d5}{HeadRoom}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ std::size\_t(data\_\ -\/\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a679f13d5591ed0e4963eb9cc078e9486}{Buffer}}());\ \}}
\DoxyCodeLine{00945\ }
\DoxyCodeLine{00951\ \ \ std::size\_t\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a23acbdc67f657564e646efe8cd9a6fa3}{TailRoom}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ std::size\_t(\mbox{\hyperlink{classkiwi_1_1_i_o_buf_a98b138b44fdf260ac04ad2c3f35a3f2f}{BufferEnd}}()\ -\/\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a27b29fcaa18008ff3ba19d93303a4082}{Tail}}());\ \}}
\DoxyCodeLine{00952\ }
\DoxyCodeLine{00960\ \ \ \textcolor{keyword}{const}\ uint8\_t*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a679f13d5591ed0e4963eb9cc078e9486}{Buffer}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ buf\_;\ \}}
\DoxyCodeLine{00961\ }
\DoxyCodeLine{00968\ \ \ uint8\_t*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a2a17715736ebb6e17e0a1f22fe46fa9a}{WritableBuffer}}()\ \{\ \textcolor{keywordflow}{return}\ buf\_;\ \}}
\DoxyCodeLine{00969\ }
\DoxyCodeLine{00977\ \ \ \textcolor{keyword}{const}\ uint8\_t*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a98b138b44fdf260ac04ad2c3f35a3f2f}{BufferEnd}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ buf\_\ +\ capacity\_;\ \}}
\DoxyCodeLine{00978\ }
\DoxyCodeLine{00985\ \ \ std::size\_t\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ capacity\_;\ \}}
\DoxyCodeLine{00986\ }
\DoxyCodeLine{00990\ \ \ IOBuf*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_aea1b72cbad61f1afcc081eaad99590d5}{Next}}()\ \{\ \textcolor{keywordflow}{return}\ next\_;\ \}}
\DoxyCodeLine{00991\ }
\DoxyCodeLine{00993\ \ \ \textcolor{keyword}{const}\ IOBuf*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_aeb8c881127b62ed7370552cba6d1db21}{Next}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ next\_;\ \}}
\DoxyCodeLine{00994\ }
\DoxyCodeLine{00998\ \ \ IOBuf*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6e6cfe3b15ad1c481d93926b3c0337a4}{Prev}}()\ \{\ \textcolor{keywordflow}{return}\ prev\_;\ \}}
\DoxyCodeLine{00999\ }
\DoxyCodeLine{01001\ \ \ \textcolor{keyword}{const}\ IOBuf*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ad34fb6470113b215c11dc1b84296ac50}{Prev}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ prev\_;\ \}}
\DoxyCodeLine{01002\ }
\DoxyCodeLine{01021\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_aff66dd7c31c9340d6b9a64b4026d1b5f}{Advance}}(std::size\_t\ amount)\ \{}
\DoxyCodeLine{01022\ \ \ \ \ \textcolor{comment}{//\ In\ debug\ builds,\ assert\ if\ there\ is\ a\ problem.}}
\DoxyCodeLine{01023\ \ \ \ \ assert(amount\ <=\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a23acbdc67f657564e646efe8cd9a6fa3}{TailRoom}}());}
\DoxyCodeLine{01024\ }
\DoxyCodeLine{01025\ \ \ \ \ \textcolor{keywordflow}{if}\ (length\_\ >\ 0)\ \{}
\DoxyCodeLine{01026\ \ \ \ \ \ \ memmove(data\_\ +\ amount,\ data\_,\ length\_);}
\DoxyCodeLine{01027\ \ \ \ \ \}}
\DoxyCodeLine{01028\ }
\DoxyCodeLine{01029\ \ \ \ \ data\_\ +=\ amount;}
\DoxyCodeLine{01030\ \ \ \}}
\DoxyCodeLine{01031\ }
\DoxyCodeLine{01049\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_adc048704e057d61e58e09367661d2454}{Retreat}}(std::size\_t\ amount)\ \{}
\DoxyCodeLine{01050\ \ \ \ \ \textcolor{comment}{//\ In\ debug\ builds,\ assert\ if\ there\ is\ a\ problem.}}
\DoxyCodeLine{01051\ \ \ \ \ assert(amount\ <=\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a9f9c776ad615d21567b831945c1529d5}{HeadRoom}}());}
\DoxyCodeLine{01052\ }
\DoxyCodeLine{01053\ \ \ \ \ \textcolor{keywordflow}{if}\ (length\_\ >\ 0)\ \{}
\DoxyCodeLine{01054\ \ \ \ \ \ \ memmove(data\_\ -\/\ amount,\ data\_,\ length\_);}
\DoxyCodeLine{01055\ \ \ \ \ \}}
\DoxyCodeLine{01056\ }
\DoxyCodeLine{01057\ \ \ \ \ data\_\ -\/=\ amount;}
\DoxyCodeLine{01058\ \ \ \}}
\DoxyCodeLine{01059\ }
\DoxyCodeLine{01073\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a4f0412a09fd45d6c4092363c4da2cd89}{Prepend}}(std::size\_t\ amount)\ \{}
\DoxyCodeLine{01074\ \ \ \ \ DCHECK\_LE(amount,\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a9f9c776ad615d21567b831945c1529d5}{HeadRoom}}());}
\DoxyCodeLine{01075\ }
\DoxyCodeLine{01076\ \ \ \ \ data\_\ -\/=\ amount;}
\DoxyCodeLine{01077\ \ \ \ \ length\_\ +=\ amount;}
\DoxyCodeLine{01078\ \ \ \}}
\DoxyCodeLine{01079\ }
\DoxyCodeLine{01093\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a984449ddf4541eca038b1b4f7b93dd97}{Append}}(std::size\_t\ amount)\ \{}
\DoxyCodeLine{01094\ \ \ \ \ DCHECK\_LE(amount,\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a23acbdc67f657564e646efe8cd9a6fa3}{TailRoom}}());}
\DoxyCodeLine{01095\ }
\DoxyCodeLine{01096\ \ \ \ \ length\_\ +=\ amount;}
\DoxyCodeLine{01097\ \ \ \}}
\DoxyCodeLine{01098\ }
\DoxyCodeLine{01111\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ab3d9b6d522b325ff3d8ba04dcafe3203}{TrimStart}}(std::size\_t\ amount)\ \{}
\DoxyCodeLine{01112\ \ \ \ \ DCHECK\_LE(amount,\ length\_);}
\DoxyCodeLine{01113\ }
\DoxyCodeLine{01114\ \ \ \ \ data\_\ +=\ amount;}
\DoxyCodeLine{01115\ \ \ \ \ length\_\ -\/=\ amount;}
\DoxyCodeLine{01116\ \ \ \}}
\DoxyCodeLine{01117\ }
\DoxyCodeLine{01130\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_adb54ae0c205585a88308117dd3e8354e}{TrimEnd}}(std::size\_t\ amount)\ \{}
\DoxyCodeLine{01131\ \ \ \ \ DCHECK\_LE(amount,\ length\_);}
\DoxyCodeLine{01132\ }
\DoxyCodeLine{01133\ \ \ \ \ length\_\ -\/=\ amount;}
\DoxyCodeLine{01134\ \ \ \}}
\DoxyCodeLine{01135\ }
\DoxyCodeLine{01146\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ab4c768ff0dfc147881a75afc1fe403ea}{TrimWritableTail}}(std::size\_t\ amount)\ \{}
\DoxyCodeLine{01147\ \ \ \ \ DCHECK\_LE(amount,\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a23acbdc67f657564e646efe8cd9a6fa3}{TailRoom}}());}
\DoxyCodeLine{01148\ }
\DoxyCodeLine{01149\ \ \ \ \ capacity\_\ -\/=\ amount;}
\DoxyCodeLine{01150\ \ \ \}}
\DoxyCodeLine{01151\ }
\DoxyCodeLine{01156\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a840a75e5d2f1cc2fb467260fda98ea52}{clear}}()\ \{}
\DoxyCodeLine{01157\ \ \ \ \ data\_\ =\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a2a17715736ebb6e17e0a1f22fe46fa9a}{WritableBuffer}}();}
\DoxyCodeLine{01158\ \ \ \ \ length\_\ =\ 0;}
\DoxyCodeLine{01159\ \ \ \}}
\DoxyCodeLine{01160\ }
\DoxyCodeLine{01177\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6e23d4cbb808550af93558459aaa092d}{reserve}}(std::size\_t\ min\_head\_room,\ std::size\_t\ min\_tail\_room)\ \{}
\DoxyCodeLine{01178\ \ \ \ \ \textcolor{comment}{//\ Maybe\ we\ don't\ need\ to\ do\ anything.}}
\DoxyCodeLine{01179\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classkiwi_1_1_i_o_buf_a9f9c776ad615d21567b831945c1529d5}{HeadRoom}}()\ >=\ min\_head\_room\ \&\&\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a23acbdc67f657564e646efe8cd9a6fa3}{TailRoom}}()\ >=\ min\_tail\_room)\ \{}
\DoxyCodeLine{01180\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01181\ \ \ \ \ \}}
\DoxyCodeLine{01182\ }
\DoxyCodeLine{01183\ \ \ \ \ \textcolor{comment}{//\ If\ the\ buffer\ is\ empty\ but\ we\ have\ enough\ total\ room\ (head\ +\ tail),}}
\DoxyCodeLine{01184\ \ \ \ \ \textcolor{comment}{//\ move\ the\ data\_\ pointer\ around.}}
\DoxyCodeLine{01185\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classkiwi_1_1_i_o_buf_a73808ff60c3bdbd250e0a4dbf556dd45}{Length}}()\ ==\ 0\ \&\&}
\DoxyCodeLine{01186\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a9f9c776ad615d21567b831945c1529d5}{HeadRoom}}()\ +\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a23acbdc67f657564e646efe8cd9a6fa3}{TailRoom}}()\ >=\ min\_head\_room\ +\ min\_tail\_room)\ \{}
\DoxyCodeLine{01187\ \ \ \ \ \ \ data\_\ =\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a2a17715736ebb6e17e0a1f22fe46fa9a}{WritableBuffer}}()\ +\ min\_head\_room;}
\DoxyCodeLine{01188\ }
\DoxyCodeLine{01189\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01190\ \ \ \ \ \}}
\DoxyCodeLine{01191\ }
\DoxyCodeLine{01192\ \ \ \ \ \textcolor{comment}{//\ Bah,\ we\ have\ to\ do\ actual\ work.}}
\DoxyCodeLine{01193\ \ \ \ \ ReserveSlow(min\_head\_room,\ min\_tail\_room);}
\DoxyCodeLine{01194\ \ \ \}}
\DoxyCodeLine{01195\ }
\DoxyCodeLine{01205\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a327d1deedf8559d086fe372e7de6c753}{IsChained}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01206\ \ \ \ \ assert((next\_\ ==\ \textcolor{keyword}{this})\ ==\ (prev\_\ ==\ \textcolor{keyword}{this}));}
\DoxyCodeLine{01207\ }
\DoxyCodeLine{01208\ \ \ \ \ \textcolor{keywordflow}{return}\ next\_\ !=\ \textcolor{keyword}{this};}
\DoxyCodeLine{01209\ \ \ \}}
\DoxyCodeLine{01210\ }
\DoxyCodeLine{01218\ \ \ \textcolor{keywordtype}{size\_t}\ CountChainElements()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01219\ }
\DoxyCodeLine{01225\ \ \ std::size\_t\ ComputeChainDataLength()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01226\ }
\DoxyCodeLine{01232\ \ \ std::size\_t\ ComputeChainCapacity()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01233\ }
\DoxyCodeLine{01242\ \ \ \textcolor{keywordtype}{void}\ AppendToChain(std::unique\_ptr<IOBuf>\&\&\ iobuf);}
\DoxyCodeLine{01243\ }
\DoxyCodeLine{01255\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a39cce2803d306fcb964a3087b8a030e7}{InsertAfterThisOne}}(std::unique\_ptr<IOBuf>\&\&\ iobuf)\ \{}
\DoxyCodeLine{01256\ \ \ \ \ \textcolor{comment}{//\ Just\ use\ appendToChain()\ on\ the\ next\ element\ in\ our\ chain}}
\DoxyCodeLine{01257\ \ \ \ \ next\_-\/>AppendToChain(std::move(iobuf));}
\DoxyCodeLine{01258\ \ \ \}}
\DoxyCodeLine{01259\ }
\DoxyCodeLine{01270\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a8c15c5b8a4558580586e7b01940c48d6}{PrependChain}}(std::unique\_ptr<IOBuf>\&\&\ iobuf)\ \{}
\DoxyCodeLine{01271\ \ \ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a21785f202ca90b05faa6d4b9483c2206}{AppendToChain}}(std::move(iobuf));}
\DoxyCodeLine{01272\ \ \ \}}
\DoxyCodeLine{01273\ }
\DoxyCodeLine{01280\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a7feebf266b48e22f583c927a86a98cd0}{AppendChain}}(std::unique\_ptr<IOBuf>\&\&\ iobuf)\ \{}
\DoxyCodeLine{01281\ \ \ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a39cce2803d306fcb964a3087b8a030e7}{InsertAfterThisOne}}(std::move(iobuf));}
\DoxyCodeLine{01282\ \ \ \}}
\DoxyCodeLine{01283\ }
\DoxyCodeLine{01299\ \ \ std::unique\_ptr<IOBuf>\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a45cd21c00ea100c65d0a01fb07d70303}{Unlink}}()\ \{}
\DoxyCodeLine{01300\ \ \ \ \ next\_-\/>prev\_\ =\ prev\_;}
\DoxyCodeLine{01301\ \ \ \ \ prev\_-\/>next\_\ =\ next\_;}
\DoxyCodeLine{01302\ \ \ \ \ prev\_\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{01303\ \ \ \ \ next\_\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{01304\ }
\DoxyCodeLine{01305\ \ \ \ \ \textcolor{keywordflow}{return}\ std::unique\_ptr<IOBuf>(\textcolor{keyword}{this});}
\DoxyCodeLine{01306\ \ \ \}}
\DoxyCodeLine{01307\ }
\DoxyCodeLine{01319\ \ \ std::unique\_ptr<IOBuf>\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_afc8005e47b46e804cf63c89614a2ff2b}{pop}}()\ \{}
\DoxyCodeLine{01320\ \ \ \ \ IOBuf*\ next\ =\ next\_;}
\DoxyCodeLine{01321\ \ \ \ \ next\_-\/>prev\_\ =\ prev\_;}
\DoxyCodeLine{01322\ \ \ \ \ prev\_-\/>next\_\ =\ next\_;}
\DoxyCodeLine{01323\ \ \ \ \ prev\_\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{01324\ \ \ \ \ next\_\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{01325\ }
\DoxyCodeLine{01326\ \ \ \ \ \textcolor{keywordflow}{return}\ std::unique\_ptr<IOBuf>((next\ ==\ \textcolor{keyword}{this})\ ?\ \textcolor{keyword}{nullptr}\ :\ next);}
\DoxyCodeLine{01327\ \ \ \}}
\DoxyCodeLine{01328\ }
\DoxyCodeLine{01352\ \ \ std::unique\_ptr<IOBuf>\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_af3c0af6870164ad98f8470ef984d8fe2}{SeparateChain}}(IOBuf*\ head,\ IOBuf*\ tail)\ \{}
\DoxyCodeLine{01353\ \ \ \ \ assert(head\ !=\ \textcolor{keyword}{this});}
\DoxyCodeLine{01354\ \ \ \ \ assert(tail\ !=\ \textcolor{keyword}{this});}
\DoxyCodeLine{01355\ }
\DoxyCodeLine{01356\ \ \ \ \ head-\/>prev\_-\/>next\_\ =\ tail-\/>next\_;}
\DoxyCodeLine{01357\ \ \ \ \ tail-\/>next\_-\/>prev\_\ =\ head-\/>prev\_;}
\DoxyCodeLine{01358\ }
\DoxyCodeLine{01359\ \ \ \ \ head-\/>prev\_\ =\ tail;}
\DoxyCodeLine{01360\ \ \ \ \ tail-\/>next\_\ =\ head;}
\DoxyCodeLine{01361\ }
\DoxyCodeLine{01362\ \ \ \ \ \textcolor{keywordflow}{return}\ std::unique\_ptr<IOBuf>(head);}
\DoxyCodeLine{01363\ \ \ \}}
\DoxyCodeLine{01364\ }
\DoxyCodeLine{01378\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ad6d427b0dc2129015373da3e25c52d15}{IsShared}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01379\ \ \ \ \ \textcolor{keyword}{const}\ IOBuf*\ current\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{01380\ }
\DoxyCodeLine{01381\ \ \ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{01382\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (current-\/>\mbox{\hyperlink{classkiwi_1_1_i_o_buf_acfe2272b3bce96c3abb4d0943ef4fc9b}{IsSharedOne}}())\ \{}
\DoxyCodeLine{01383\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01384\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01385\ }
\DoxyCodeLine{01386\ \ \ \ \ \ \ current\ =\ current-\/>next\_;}
\DoxyCodeLine{01387\ }
\DoxyCodeLine{01388\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (current\ ==\ \textcolor{keyword}{this})\ \{}
\DoxyCodeLine{01389\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01390\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01391\ \ \ \ \ \}}
\DoxyCodeLine{01392\ \ \ \}}
\DoxyCodeLine{01393\ }
\DoxyCodeLine{01402\ \ \ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a60bb8092a47d0323280174c78d61c3c2}{GetUserData}}()\ const\ noexcept\ \{}
\DoxyCodeLine{01403\ \ \ \ \ \textcolor{keyword}{auto}\ info\ =\ GetSharedInfo();}
\DoxyCodeLine{01404\ }
\DoxyCodeLine{01405\ \ \ \ \ \textcolor{keywordflow}{return}\ info\ ?\ info-\/>user\_data\ :\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01406\ \ \ \}}
\DoxyCodeLine{01407\ }
\DoxyCodeLine{01416\ \ \ FreeFunction\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a28e1ea256d1bd6bbbdafdea48dfed2eb}{GetFreeFn}}()\ const\ noexcept\ \{}
\DoxyCodeLine{01417\ \ \ \ \ \textcolor{keyword}{auto}\ info\ =\ GetSharedInfo();}
\DoxyCodeLine{01418\ }
\DoxyCodeLine{01419\ \ \ \ \ \textcolor{keywordflow}{return}\ info\ ?\ info-\/>free\_fn\ :\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01420\ \ \ \}}
\DoxyCodeLine{01421\ }
\DoxyCodeLine{01429\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Observer>}
\DoxyCodeLine{01430\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a459ea5071c51a5015b35dafeae183ff0}{AppendSharedInfoObserver}}(Observer\&\&\ observer)\ \{}
\DoxyCodeLine{01431\ \ \ \ \ \textcolor{keyword}{auto}\ info\ =\ GetSharedInfo();}
\DoxyCodeLine{01432\ }
\DoxyCodeLine{01433\ \ \ \ \ \textcolor{keywordflow}{if}\ (!info)\ \{}
\DoxyCodeLine{01434\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01435\ \ \ \ \ \}}
\DoxyCodeLine{01436\ }
\DoxyCodeLine{01437\ \ \ \ \ \textcolor{keyword}{auto}*\ entry\ =}
\DoxyCodeLine{01438\ \ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ SharedInfoObserverEntry<Observer>(std::forward<Observer>(observer));}
\DoxyCodeLine{01439\ \ \ \ \ std::lock\_guard<std::mutex>\ guard(info-\/>observer\_list\_lock);}
\DoxyCodeLine{01440\ }
\DoxyCodeLine{01441\ \ \ \ \ \textcolor{keywordflow}{if}\ (!info-\/>observer\_list\_head)\ \{}
\DoxyCodeLine{01442\ \ \ \ \ \ \ info-\/>observer\_list\_head\ =\ entry;}
\DoxyCodeLine{01443\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01444\ \ \ \ \ \ \ \textcolor{comment}{//\ prepend}}
\DoxyCodeLine{01445\ \ \ \ \ \ \ entry-\/>next\ =\ info-\/>observer\_list\_head;}
\DoxyCodeLine{01446\ \ \ \ \ \ \ entry-\/>prev\ =\ info-\/>observer\_list\_head-\/>prev;}
\DoxyCodeLine{01447\ \ \ \ \ \ \ info-\/>observer\_list\_head-\/>prev-\/>next\ =\ entry;}
\DoxyCodeLine{01448\ \ \ \ \ \ \ info-\/>observer\_list\_head-\/>prev\ =\ entry;}
\DoxyCodeLine{01449\ \ \ \ \ \}}
\DoxyCodeLine{01450\ }
\DoxyCodeLine{01451\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01452\ \ \ \}}
\DoxyCodeLine{01453\ }
\DoxyCodeLine{01462\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ae206bc7d596ee0679fb459e6f44f2756}{IsManaged}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01463\ \ \ \ \ \textcolor{keyword}{const}\ IOBuf*\ current\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{01464\ }
\DoxyCodeLine{01465\ \ \ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{01466\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!current-\/>\mbox{\hyperlink{classkiwi_1_1_i_o_buf_ab044ec809760986f38f05f56048c90ce}{IsManagedOne}}())\ \{}
\DoxyCodeLine{01467\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01468\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01469\ }
\DoxyCodeLine{01470\ \ \ \ \ \ \ current\ =\ current-\/>next\_;}
\DoxyCodeLine{01471\ }
\DoxyCodeLine{01472\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (current\ ==\ \textcolor{keyword}{this})\ \{}
\DoxyCodeLine{01473\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01474\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01475\ \ \ \ \ \}}
\DoxyCodeLine{01476\ \ \ \}}
\DoxyCodeLine{01477\ }
\DoxyCodeLine{01488\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ab044ec809760986f38f05f56048c90ce}{IsManagedOne}}()\ const\ noexcept\ \{\ \textcolor{keywordflow}{return}\ GetSharedInfo();\ \}}
\DoxyCodeLine{01489\ }
\DoxyCodeLine{01505\ \ \ uint32\_t\ ApproximateShareCountOne()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01506\ }
\DoxyCodeLine{01519\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_acfe2272b3bce96c3abb4d0943ef4fc9b}{IsSharedOne}}()\ const\ noexcept\ \{}
\DoxyCodeLine{01520\ \ \ \ \ \textcolor{keyword}{auto}\ info\ =\ GetSharedInfo();}
\DoxyCodeLine{01521\ }
\DoxyCodeLine{01522\ \ \ \ \ \textcolor{comment}{//\ If\ this\ is\ a\ user-\/owned\ buffer,\ it\ is\ always\ considered\ shared.}}
\DoxyCodeLine{01523\ \ \ \ \ \textcolor{keywordflow}{if}\ (!info)\ [[unlikely]]\ \{}
\DoxyCodeLine{01524\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01525\ \ \ \ \ \}}
\DoxyCodeLine{01526\ }
\DoxyCodeLine{01527\ \ \ \ \ \textcolor{keywordflow}{if}\ (info-\/>externally\_shared)\ [[unlikely]]\ \{}
\DoxyCodeLine{01528\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01529\ \ \ \ \ \}}
\DoxyCodeLine{01530\ }
\DoxyCodeLine{01531\ \ \ \ \ \textcolor{keywordflow}{return}\ info-\/>refcount.load(std::memory\_order\_acquire)\ >\ 1;}
\DoxyCodeLine{01532\ \ \ \}}
\DoxyCodeLine{01533\ }
\DoxyCodeLine{01562\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a02310eb3c6cfac120d0b7d962097e6ab}{Unshare}}()\ \{}
\DoxyCodeLine{01563\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classkiwi_1_1_i_o_buf_a327d1deedf8559d086fe372e7de6c753}{IsChained}}())\ \{}
\DoxyCodeLine{01564\ \ \ \ \ \ \ UnshareChained();}
\DoxyCodeLine{01565\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01566\ \ \ \ \ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a3a25efa83923b3904420315cfcbbbd0a}{UnshareOne}}();}
\DoxyCodeLine{01567\ \ \ \ \ \}}
\DoxyCodeLine{01568\ \ \ \}}
\DoxyCodeLine{01569\ }
\DoxyCodeLine{01579\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a3a25efa83923b3904420315cfcbbbd0a}{UnshareOne}}()\ \{}
\DoxyCodeLine{01580\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classkiwi_1_1_i_o_buf_acfe2272b3bce96c3abb4d0943ef4fc9b}{IsSharedOne}}())\ \{}
\DoxyCodeLine{01581\ \ \ \ \ \ \ UnshareOneSlow();}
\DoxyCodeLine{01582\ \ \ \ \ \}}
\DoxyCodeLine{01583\ \ \ \}}
\DoxyCodeLine{01584\ }
\DoxyCodeLine{01594\ \ \ \textcolor{keywordtype}{void}\ MarkExternallyShared();}
\DoxyCodeLine{01595\ }
\DoxyCodeLine{01605\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_aca41d072b060f79a73bc3e6b67dca4bb}{MarkExternallySharedOne}}()\ \{}
\DoxyCodeLine{01606\ \ \ \ \ \textcolor{keyword}{auto}\ info\ =\ GetSharedInfo();}
\DoxyCodeLine{01607\ }
\DoxyCodeLine{01608\ \ \ \ \ \textcolor{keywordflow}{if}\ (info)\ \{}
\DoxyCodeLine{01609\ \ \ \ \ \ \ info-\/>externally\_shared\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01610\ \ \ \ \ \}}
\DoxyCodeLine{01611\ \ \ \}}
\DoxyCodeLine{01612\ }
\DoxyCodeLine{01624\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a2c24eab145eaf298ac70d02eee0baa3d}{MakeManaged}}()\ \{}
\DoxyCodeLine{01625\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classkiwi_1_1_i_o_buf_a327d1deedf8559d086fe372e7de6c753}{IsChained}}())\ \{}
\DoxyCodeLine{01626\ \ \ \ \ \ \ MakeManagedChained();}
\DoxyCodeLine{01627\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01628\ \ \ \ \ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a102404f55b2abc56d44bdcd10a5e4f08}{MakeManagedOne}}();}
\DoxyCodeLine{01629\ \ \ \ \ \}}
\DoxyCodeLine{01630\ \ \ \}}
\DoxyCodeLine{01631\ }
\DoxyCodeLine{01643\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a102404f55b2abc56d44bdcd10a5e4f08}{MakeManagedOne}}()\ \{}
\DoxyCodeLine{01644\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classkiwi_1_1_i_o_buf_ab044ec809760986f38f05f56048c90ce}{IsManagedOne}}())\ \{}
\DoxyCodeLine{01645\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ can\ call\ the\ internal\ function\ directly;\ unmanaged\ implies\ shared.}}
\DoxyCodeLine{01646\ \ \ \ \ \ \ UnshareOneSlow();}
\DoxyCodeLine{01647\ \ \ \ \ \}}
\DoxyCodeLine{01648\ \ \ \}}
\DoxyCodeLine{01649\ }
\DoxyCodeLine{01669\ \ \ ByteRange\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_acc67e55ad77e64bdecd1985c89a1d3f0}{Coalesce}}()\ \{}
\DoxyCodeLine{01670\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classkiwi_1_1_i_o_buf_a327d1deedf8559d086fe372e7de6c753}{IsChained}}())\ \{}
\DoxyCodeLine{01671\ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::size\_t\ new\_head\_room\ =\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a9f9c776ad615d21567b831945c1529d5}{HeadRoom}}();}
\DoxyCodeLine{01672\ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::size\_t\ new\_tail\_room\ =\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6e6cfe3b15ad1c481d93926b3c0337a4}{Prev}}()-\/>TailRoom();}
\DoxyCodeLine{01673\ }
\DoxyCodeLine{01674\ \ \ \ \ \ \ CoalesceAndReallocate(new\_head\_room,\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a78fefcb935fa0e189324e07d03702320}{ComputeChainDataLength}}(),\ \textcolor{keyword}{this},}
\DoxyCodeLine{01675\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ new\_tail\_room);}
\DoxyCodeLine{01676\ \ \ \ \ \}}
\DoxyCodeLine{01677\ }
\DoxyCodeLine{01678\ \ \ \ \ \textcolor{keywordflow}{return}\ ByteRange(data\_,\ length\_);}
\DoxyCodeLine{01679\ \ \ \}}
\DoxyCodeLine{01680\ }
\DoxyCodeLine{01687\ \ \ ByteRange\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a330906fb632d710757b90ad5a3c95f67}{CoalesceWithHeadroomTailroom}}(std::size\_t\ new\_head\_room,}
\DoxyCodeLine{01688\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ new\_tail\_room)\ \{}
\DoxyCodeLine{01689\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classkiwi_1_1_i_o_buf_a327d1deedf8559d086fe372e7de6c753}{IsChained}}())\ \{}
\DoxyCodeLine{01690\ \ \ \ \ \ \ CoalesceAndReallocate(new\_head\_room,\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a78fefcb935fa0e189324e07d03702320}{ComputeChainDataLength}}(),\ \textcolor{keyword}{this},}
\DoxyCodeLine{01691\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ new\_tail\_room);}
\DoxyCodeLine{01692\ \ \ \ \ \}}
\DoxyCodeLine{01693\ }
\DoxyCodeLine{01694\ \ \ \ \ \textcolor{keywordflow}{return}\ ByteRange(data\_,\ length\_);}
\DoxyCodeLine{01695\ \ \ \}}
\DoxyCodeLine{01696\ }
\DoxyCodeLine{01715\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ad01aa5a69e98470d66c113e8aafb06d1}{Gather}}(std::size\_t\ contiguous\_length)\ \{}
\DoxyCodeLine{01716\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classkiwi_1_1_i_o_buf_a327d1deedf8559d086fe372e7de6c753}{IsChained}}()\ ||\ length\_\ >=\ contiguous\_length)\ \{}
\DoxyCodeLine{01717\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01718\ \ \ \ \ \}}
\DoxyCodeLine{01719\ }
\DoxyCodeLine{01720\ \ \ \ \ CoalesceSlow(contiguous\_length);}
\DoxyCodeLine{01721\ \ \ \}}
\DoxyCodeLine{01722\ }
\DoxyCodeLine{01733\ \ \ std::unique\_ptr<IOBuf>\ Clone()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01734\ }
\DoxyCodeLine{01738\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}\ CloneAsValue()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01739\ }
\DoxyCodeLine{01745\ \ \ std::unique\_ptr<IOBuf>\ CloneOne()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01746\ }
\DoxyCodeLine{01750\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}\ CloneOneAsValue()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01751\ }
\DoxyCodeLine{01766\ \ \ std::unique\_ptr<IOBuf>\ CloneCoalesced()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01767\ }
\DoxyCodeLine{01774\ \ \ std::unique\_ptr<IOBuf>\ CloneCoalescedWithHeadroomTailroom(}
\DoxyCodeLine{01775\ \ \ \ \ \ \ std::size\_t\ new\_head\_room,\ std::size\_t\ new\_tail\_room)\ \textcolor{keyword}{const};}
\DoxyCodeLine{01776\ }
\DoxyCodeLine{01781\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}\ CloneCoalescedAsValue()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01782\ }
\DoxyCodeLine{01788\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}\ CloneCoalescedAsValueWithHeadroomTailroom(}
\DoxyCodeLine{01789\ \ \ \ \ \ \ std::size\_t\ new\_head\_room,\ std::size\_t\ new\_tail\_room)\ \textcolor{keyword}{const};}
\DoxyCodeLine{01790\ }
\DoxyCodeLine{01798\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ae67aa00c7b4f098ec567446e5f80efc3}{CloneInto}}(IOBuf\&\ other)\textcolor{keyword}{\ const\ }\{\ other\ =\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ac0f7ae7b52fbea81b71d468e67cc7cd2}{CloneAsValue}}();\ \}}
\DoxyCodeLine{01799\ }
\DoxyCodeLine{01806\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a55d8e92a27d6269fc75ec508ff9f4239}{CloneOneInto}}(IOBuf\&\ other)\textcolor{keyword}{\ const\ }\{\ other\ =\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a54945401269798c696f3f17c43a5d6aa}{CloneOneAsValue}}();\ \}}
\DoxyCodeLine{01807\ }
\DoxyCodeLine{01815\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Container>}
\DoxyCodeLine{01816\ \ \ \textcolor{keywordtype}{void}\ AppendTo(Container\&\ container)\ \textcolor{keyword}{const};}
\DoxyCodeLine{01817\ }
\DoxyCodeLine{01825\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Container>}
\DoxyCodeLine{01826\ \ \ Container\ To()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01827\ }
\DoxyCodeLine{01839\ \ \ std::vector<struct\ iovec>\ GetIov()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01840\ }
\DoxyCodeLine{01852\ \ \ \textcolor{keywordtype}{void}\ AppendToIov(std::vector<struct\ iovec>*\ iov)\ \textcolor{keyword}{const};}
\DoxyCodeLine{01853\ }
\DoxyCodeLine{01854\ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structkiwi_1_1_i_o_buf_1_1_fill_iov_result}{FillIovResult}}\ \{}
\DoxyCodeLine{01856\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structkiwi_1_1_i_o_buf_1_1_fill_iov_result_aae577cd99ab04a5a5198f3c5e0fa7784}{num\_iovecs}};}
\DoxyCodeLine{01858\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structkiwi_1_1_i_o_buf_1_1_fill_iov_result_a7812a5e1834aa535994285c077485746}{total\_length}};}
\DoxyCodeLine{01859\ \ \ \};}
\DoxyCodeLine{01860\ }
\DoxyCodeLine{01875\ \ \ \mbox{\hyperlink{structkiwi_1_1_i_o_buf_1_1_fill_iov_result}{FillIovResult}}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_adf0a26330fc206a4f85b079061731413}{FillIov}}(\textcolor{keyword}{struct}\ iovec*\ iov,\ \textcolor{keywordtype}{size\_t}\ len)\ \textcolor{keyword}{const};}
\DoxyCodeLine{01876\ }
\DoxyCodeLine{01884\ \ \ \textcolor{keywordtype}{void}*\ \textcolor{keyword}{operator}\ \textcolor{keyword}{new}(\textcolor{keywordtype}{size\_t}\ size);}
\DoxyCodeLine{01885\ }
\DoxyCodeLine{01888\ \ \ \textcolor{keywordtype}{void}*\ \textcolor{keyword}{operator}\ \textcolor{keyword}{new}(\textcolor{keywordtype}{size\_t}\ size,\ \textcolor{keywordtype}{void}*\ ptr);}
\DoxyCodeLine{01889\ }
\DoxyCodeLine{01892\ \ \ \textcolor{keywordtype}{void}\ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}(\textcolor{keywordtype}{void}*\ ptr);}
\DoxyCodeLine{01893\ }
\DoxyCodeLine{01896\ \ \ \textcolor{keywordtype}{void}\ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}(\textcolor{keywordtype}{void}*\ ptr,\ \textcolor{keywordtype}{void}*\ placement);}
\DoxyCodeLine{01897\ }
\DoxyCodeLine{01905\ \ \ std::string\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a4e0fb2a8cb526cd819bdc625310cac6f}{MoveToFbString}}();}
\DoxyCodeLine{01906\ }
\DoxyCodeLine{01912\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_1_1_iterator}{Iterator}}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ad22211b3c6c1c99872f05ed23e55d138}{cbegin}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01913\ }
\DoxyCodeLine{01915\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_1_1_iterator}{Iterator}}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a815f1a7b3d0014fb9cd2c7e20a2fcd42}{cend}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01916\ }
\DoxyCodeLine{01918\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_1_1_iterator}{Iterator}}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_af9acb767b93f0efd67990f4a4351a223}{begin}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01919\ }
\DoxyCodeLine{01921\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_1_1_iterator}{Iterator}}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ad096f4cf2aaac5ee522618ad6dbe9cbc}{end}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{01922\ }
\DoxyCodeLine{01923\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{01927\ \ \ std::size\_t\ length\_\{0\};}
\DoxyCodeLine{01928\ \ \ uint8\_t*\ data\_\{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{01929\ }
\DoxyCodeLine{01930\ \ \ std::size\_t\ capacity\_\{0\};}
\DoxyCodeLine{01931\ \ \ uint8\_t*\ buf\_\{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{01932\ }
\DoxyCodeLine{01938\ \ \ IOBuf*\ next\_\{\textcolor{keyword}{this}\};}
\DoxyCodeLine{01939\ \ \ IOBuf*\ prev\_\{\textcolor{keyword}{this}\};}
\DoxyCodeLine{01940\ }
\DoxyCodeLine{01942\ \ \ uintptr\_t\ flags\_and\_shared\_info\_\{0\};}
\DoxyCodeLine{01943\ \};}
\DoxyCodeLine{01944\ }
\DoxyCodeLine{01946\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structkiwi_1_1_i_o_buf_hash}{IOBufHash}}\ \{}
\DoxyCodeLine{01947\ \ \ \textcolor{keywordtype}{size\_t}\ operator()(\textcolor{keyword}{const}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}\&\ buf)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{01948\ \ \ \textcolor{keywordtype}{size\_t}\ operator()(\textcolor{keyword}{const}\ std::unique\_ptr<IOBuf>\&\ buf)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{01949\ \ \ \ \ \textcolor{keywordflow}{return}\ operator()(buf.get());}
\DoxyCodeLine{01950\ \ \ \}}
\DoxyCodeLine{01951\ \ \ \textcolor{keywordtype}{size\_t}\ operator()(\textcolor{keyword}{const}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}*\ buf)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{01952\ \ \ \ \ \textcolor{keywordflow}{return}\ buf\ ?\ (*this)(*buf)\ :\ 0;}
\DoxyCodeLine{01953\ \ \ \}}
\DoxyCodeLine{01954\ \};}
\DoxyCodeLine{01955\ }
\DoxyCodeLine{01957\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structkiwi_1_1_i_o_buf_compare}{IOBufCompare}}\ \{}
\DoxyCodeLine{01958\ \ \ std::strong\_ordering\ operator()(\textcolor{keyword}{const}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}\&\ a,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}\&\ b)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01959\ \ \ \ \ \textcolor{keywordflow}{return}\ \&a\ ==\ \&b\ ?\ std::strong\_ordering::equal\ :\ impl(a,\ b);}
\DoxyCodeLine{01960\ \ \ \}}
\DoxyCodeLine{01961\ }
\DoxyCodeLine{01962\ \ \ std::strong\_ordering\ operator()(\textcolor{keyword}{const}\ std::unique\_ptr<IOBuf>\&\ a,}
\DoxyCodeLine{01963\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::unique\_ptr<IOBuf>\&\ b)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01964\ \ \ \ \ \textcolor{keywordflow}{return}\ operator()(a.get(),\ b.get());}
\DoxyCodeLine{01965\ \ \ \}}
\DoxyCodeLine{01966\ }
\DoxyCodeLine{01967\ \ \ std::strong\_ordering\ operator()(\textcolor{keyword}{const}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}*\ a,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}*\ b)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01968\ \ \ \ \ \textcolor{comment}{//\ clang-\/format\ off}}
\DoxyCodeLine{01969\ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{01970\ \ \ \ \ \ \ \ \ !a\ \&\&\ !b\ ?\ std::strong\_ordering::equal\ :}
\DoxyCodeLine{01971\ \ \ \ \ \ \ \ \ !a\ \&\&\ b\ ?\ \ std::strong\_ordering::less\ :}
\DoxyCodeLine{01972\ \ \ \ \ \ \ \ \ a\ \&\&\ !b\ ?\ \ std::strong\_ordering::greater\ :}
\DoxyCodeLine{01973\ \ \ \ \ \ \ \ \ operator()(*a,\ *b);}
\DoxyCodeLine{01974\ \ \ \ \ \textcolor{comment}{//\ clang-\/format\ on}}
\DoxyCodeLine{01975\ \ \ \}}
\DoxyCodeLine{01976\ }
\DoxyCodeLine{01977\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{01978\ \ \ std::strong\_ordering\ impl(\mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}\ \textcolor{keyword}{const}\&\ a,\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf}{IOBuf}}\ \textcolor{keyword}{const}\&\ b)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{01979\ \};}
\DoxyCodeLine{01980\ }
\DoxyCodeLine{01981\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ UniquePtr>}
\DoxyCodeLine{01982\ \textcolor{keyword}{typename}\ std::enable\_if<detail::IsUniquePtrToSL<UniquePtr>::value,}
\DoxyCodeLine{01983\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<IOBuf>>::type}
\DoxyCodeLine{01984\ IOBuf::TakeOwnership(UniquePtr\&\&\ buf,\ \textcolor{keywordtype}{size\_t}\ count)\ \{}
\DoxyCodeLine{01985\ \ \ \textcolor{keywordtype}{size\_t}\ size\ =\ count\ *\ \textcolor{keyword}{sizeof}(\textcolor{keyword}{typename}\ UniquePtr::element\_type);}
\DoxyCodeLine{01986\ \ \ \textcolor{keyword}{auto}\ deleter\ =\ \textcolor{keyword}{new}\ UniquePtrDeleter<UniquePtr>(buf.get\_deleter());}
\DoxyCodeLine{01987\ }
\DoxyCodeLine{01988\ \ \ \textcolor{keywordflow}{return}\ TakeOwnership(buf.release(),\ size,\ \&IOBuf::FreeUniquePtrBuffer,}
\DoxyCodeLine{01989\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ deleter);}
\DoxyCodeLine{01990\ \}}
\DoxyCodeLine{01991\ }
\DoxyCodeLine{01992\ \textcolor{keyword}{inline}\ std::unique\_ptr<IOBuf>\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a5c9ba80c7ca24ab312bfca2816e184bb}{IOBuf::CopyBuffer}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a708944d0de466a93fda5102be9ceb938}{data}},}
\DoxyCodeLine{01993\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ size,}
\DoxyCodeLine{01994\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ head\_room,}
\DoxyCodeLine{01995\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ min\_tail\_room)\ \{}
\DoxyCodeLine{01996\ \ \ std::size\_t\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}};}
\DoxyCodeLine{01997\ }
\DoxyCodeLine{01998\ \ \ \textcolor{keywordflow}{if}\ (!kiwi::checked\_add(\&\mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}},\ size,\ head\_room,\ min\_tail\_room))\ \{}
\DoxyCodeLine{01999\ \ \ \ \ \mbox{\hyperlink{namespacekiwi_abe3cc88b10ffe4cc4b1796c4bf782900}{throw\_exception}}(std::length\_error(\textcolor{stringliteral}{"{}"{}}));}
\DoxyCodeLine{02000\ \ \ \}}
\DoxyCodeLine{02001\ }
\DoxyCodeLine{02002\ \ \ std::unique\_ptr<IOBuf>\ buf\ =\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a8e0900f4f9d06d41fa4e7c083217c6a5}{Create}}(\mbox{\hyperlink{classkiwi_1_1_i_o_buf_a6adefcda03cb041c68d4341ef4eec966}{capacity}});}
\DoxyCodeLine{02003\ \ \ buf-\/>Advance(head\_room);}
\DoxyCodeLine{02004\ }
\DoxyCodeLine{02005\ \ \ \textcolor{keywordflow}{if}\ (size\ !=\ 0)\ \{}
\DoxyCodeLine{02006\ \ \ \ \ memcpy(buf-\/>WritableData(),\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a708944d0de466a93fda5102be9ceb938}{data}},\ size);}
\DoxyCodeLine{02007\ \ \ \}}
\DoxyCodeLine{02008\ }
\DoxyCodeLine{02009\ \ \ buf-\/>Append(size);}
\DoxyCodeLine{02010\ }
\DoxyCodeLine{02011\ \ \ \textcolor{keywordflow}{return}\ buf;}
\DoxyCodeLine{02012\ \}}
\DoxyCodeLine{02013\ }
\DoxyCodeLine{02014\ \textcolor{keyword}{inline}\ std::unique\_ptr<IOBuf>\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a5c9ba80c7ca24ab312bfca2816e184bb}{IOBuf::CopyBuffer}}(std::string\_view\ buf,}
\DoxyCodeLine{02015\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ head\_room,}
\DoxyCodeLine{02016\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::size\_t\ min\_tail\_room)\ \{}
\DoxyCodeLine{02017\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a5c9ba80c7ca24ab312bfca2816e184bb}{CopyBuffer}}(buf.data(),\ buf.size(),\ head\_room,\ min\_tail\_room);}
\DoxyCodeLine{02018\ \}}
\DoxyCodeLine{02019\ }
\DoxyCodeLine{02020\ \textcolor{keyword}{inline}\ std::unique\_ptr<IOBuf>\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a3cb72bf084625127b80ca48d1d2b404d}{IOBuf::MaybeCopyBuffer}}(}
\DoxyCodeLine{02021\ \ \ \ \ std::string\_view\ buf,\ std::size\_t\ head\_room,\ std::size\_t\ min\_tail\_room)\ \{}
\DoxyCodeLine{02022\ \ \ \textcolor{keywordflow}{if}\ (buf.empty())\ \{}
\DoxyCodeLine{02023\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{02024\ \ \ \}}
\DoxyCodeLine{02025\ }
\DoxyCodeLine{02026\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a5c9ba80c7ca24ab312bfca2816e184bb}{CopyBuffer}}(buf.data(),\ buf.size(),\ head\_room,\ min\_tail\_room);}
\DoxyCodeLine{02027\ \}}
\DoxyCodeLine{02028\ }
\DoxyCodeLine{02029\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classkiwi_1_1_i_o_buf_1_1_iterator}{IOBuf::Iterator}}}
\DoxyCodeLine{02030\ \ \ \ \ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classkiwi_1_1detail_1_1_iterator_facade}{detail::IteratorFacade}}<IOBuf::Iterator,\ ByteRange\ const,}
\DoxyCodeLine{02031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::forward\_iterator\_tag>\ \{}
\DoxyCodeLine{02032\ \ \ \textcolor{keywordtype}{void}\ SetVal()\ \{}
\DoxyCodeLine{02033\ \ \ \ \ \textcolor{keyword}{auto}\ tmp\ =\ \textcolor{keyword}{const\_cast<}IOBuf*\textcolor{keyword}{>}(pos\_);}
\DoxyCodeLine{02034\ }
\DoxyCodeLine{02035\ \ \ \ \ val\_\ =\ ByteRange(tmp-\/>WritableData(),\ tmp-\/>WritableTail());}
\DoxyCodeLine{02036\ \ \ \}}
\DoxyCodeLine{02037\ }
\DoxyCodeLine{02038\ \ \ \textcolor{keywordtype}{void}\ AdjustForEnd()\ \{}
\DoxyCodeLine{02039\ \ \ \ \ \textcolor{keywordflow}{if}\ (pos\_\ ==\ end\_)\ \{}
\DoxyCodeLine{02040\ \ \ \ \ \ \ pos\_\ =\ end\_\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{02041\ \ \ \ \ \ \ val\_\ =\ ByteRange();}
\DoxyCodeLine{02042\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02043\ \ \ \ \ \ \ SetVal();}
\DoxyCodeLine{02044\ \ \ \ \ \}}
\DoxyCodeLine{02045\ \ \ \}}
\DoxyCodeLine{02046\ }
\DoxyCodeLine{02047\ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{02048\ \ \ \textcolor{comment}{//\ Note\ that\ IOBufs\ are\ stored\ as\ a\ circular\ list\ without\ a\ guard\ node,}}
\DoxyCodeLine{02049\ \ \ \textcolor{comment}{//\ so\ pos\ ==\ end\ is\ ambiguous\ (it\ may\ mean\ "{}begin"{}\ or\ "{}end"{}).\ \ To\ solve}}
\DoxyCodeLine{02050\ \ \ \textcolor{comment}{//\ the\ ambiguity\ (at\ the\ cost\ of\ one\ extra\ comparison\ in\ the\ "{}increment"{}}}
\DoxyCodeLine{02051\ \ \ \textcolor{comment}{//\ code\ path),\ we\ define\ end\ iterators\ as\ having\ pos\_\ ==\ end\_\ ==\ nullptr}}
\DoxyCodeLine{02052\ \ \ \textcolor{comment}{//\ and\ we\ only\ allow\ forward\ iteration.}}
\DoxyCodeLine{02053\ \ \ \textcolor{keyword}{explicit}\ Iterator(\textcolor{keyword}{const}\ IOBuf*\ pos,\ \textcolor{keyword}{const}\ IOBuf*\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ad096f4cf2aaac5ee522618ad6dbe9cbc}{end}})\ :\ pos\_(pos),\ end\_(\mbox{\hyperlink{classkiwi_1_1_i_o_buf_ad096f4cf2aaac5ee522618ad6dbe9cbc}{end}})\ \{}
\DoxyCodeLine{02054\ \ \ \ \ \textcolor{comment}{//\ Sadly,\ we\ must\ return\ by\ const\ reference,\ not\ by\ value.}}
\DoxyCodeLine{02055\ \ \ \ \ \textcolor{keywordflow}{if}\ (pos\_)\ \{}
\DoxyCodeLine{02056\ \ \ \ \ \ \ SetVal();}
\DoxyCodeLine{02057\ \ \ \ \ \}}
\DoxyCodeLine{02058\ \ \ \}}
\DoxyCodeLine{02059\ }
\DoxyCodeLine{02060\ \ \ Iterator()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{02061\ \ \ Iterator(Iterator\ \textcolor{keyword}{const}\&\ rhs)\ :\ Iterator(rhs.pos\_,\ rhs.end\_)\ \{\}}
\DoxyCodeLine{02062\ \ \ Iterator\&\ operator=(Iterator\ \textcolor{keyword}{const}\&\ rhs)\ \{}
\DoxyCodeLine{02063\ \ \ \ \ pos\_\ =\ rhs.pos\_;}
\DoxyCodeLine{02064\ \ \ \ \ end\_\ =\ rhs.end\_;}
\DoxyCodeLine{02065\ }
\DoxyCodeLine{02066\ \ \ \ \ \textcolor{keywordflow}{if}\ (pos\_)\ \{}
\DoxyCodeLine{02067\ \ \ \ \ \ \ SetVal();}
\DoxyCodeLine{02068\ \ \ \ \ \}}
\DoxyCodeLine{02069\ }
\DoxyCodeLine{02070\ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{02071\ \ \ \}}
\DoxyCodeLine{02072\ }
\DoxyCodeLine{02073\ \ \ \textcolor{keyword}{const}\ ByteRange\&\ Dereference()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ val\_;\ \}}
\DoxyCodeLine{02074\ \ \ \textcolor{keywordtype}{bool}\ IsEqual(\textcolor{keyword}{const}\ Iterator\&\ other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02075\ \ \ \ \ \textcolor{comment}{//\ We\ must\ compare\ end\_\ in\ addition\ to\ pos\_,\ because\ forward\ traversal}}
\DoxyCodeLine{02076\ \ \ \ \ \textcolor{comment}{//\ requires\ that\ if\ two\ iterators\ are\ equal\ (a\ ==\ b)\ and\ dereferenceable,}}
\DoxyCodeLine{02077\ \ \ \ \ \textcolor{comment}{//\ then\ ++a\ ==\ ++b.}}
\DoxyCodeLine{02078\ \ \ \ \ \textcolor{keywordflow}{return}\ pos\_\ ==\ other.pos\_\ \&\&\ end\_\ ==\ other.end\_;}
\DoxyCodeLine{02079\ \ \ \}}
\DoxyCodeLine{02080\ }
\DoxyCodeLine{02081\ \ \ \textcolor{keywordtype}{void}\ Increment()\ \{}
\DoxyCodeLine{02082\ \ \ \ \ pos\_\ =\ pos\_-\/>\mbox{\hyperlink{classkiwi_1_1_i_o_buf_aea1b72cbad61f1afcc081eaad99590d5}{Next}}();}
\DoxyCodeLine{02083\ \ \ \ \ AdjustForEnd();}
\DoxyCodeLine{02084\ \ \ \}}
\DoxyCodeLine{02085\ }
\DoxyCodeLine{02086\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{02087\ \ \ \textcolor{keyword}{const}\ IOBuf*\ pos\_\{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{02088\ \ \ \textcolor{keyword}{const}\ IOBuf*\ end\_\{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{02089\ \ \ ByteRange\ val\_;}
\DoxyCodeLine{02090\ \};}
\DoxyCodeLine{02091\ }
\DoxyCodeLine{02092\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_1_1_iterator}{IOBuf::Iterator}}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_af9acb767b93f0efd67990f4a4351a223}{IOBuf::begin}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ad22211b3c6c1c99872f05ed23e55d138}{cbegin}}();\ \}}
\DoxyCodeLine{02093\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_1_1_iterator}{IOBuf::Iterator}}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_ad096f4cf2aaac5ee522618ad6dbe9cbc}{IOBuf::end}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a815f1a7b3d0014fb9cd2c7e20a2fcd42}{cend}}();\ \}}
\DoxyCodeLine{02094\ }
\DoxyCodeLine{02095\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Container>}
\DoxyCodeLine{02096\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a7b47ae84869903d1c7e60c2fff9866d5}{IOBuf::AppendTo}}(Container\&\ container)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02097\ \ \ \textcolor{keyword}{static\_assert}(std::is\_same\_v<typename\ Container::value\_type,\ uint8\_t>,}
\DoxyCodeLine{02098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Unsupported\ value\ type"{}});}
\DoxyCodeLine{02099\ }
\DoxyCodeLine{02100\ \ \ container.reserve(container.size()\ +\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a78fefcb935fa0e189324e07d03702320}{ComputeChainDataLength}}());}
\DoxyCodeLine{02101\ }
\DoxyCodeLine{02102\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a708944d0de466a93fda5102be9ceb938}{data}}\ :\ *\textcolor{keyword}{this})\ \{}
\DoxyCodeLine{02103\ \ \ \ \ container.insert(container.end(),\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a708944d0de466a93fda5102be9ceb938}{data}}.begin(),\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a708944d0de466a93fda5102be9ceb938}{data}}.end());}
\DoxyCodeLine{02104\ \ \ \}}
\DoxyCodeLine{02105\ \}}
\DoxyCodeLine{02106\ }
\DoxyCodeLine{02107\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Container>}
\DoxyCodeLine{02108\ Container\ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_abe51f49dc01310e4cb457238b0a2ffe8}{IOBuf::To}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02109\ \ \ Container\ result;}
\DoxyCodeLine{02110\ \ \ \mbox{\hyperlink{classkiwi_1_1_i_o_buf_a7b47ae84869903d1c7e60c2fff9866d5}{AppendTo}}(result);}
\DoxyCodeLine{02111\ }
\DoxyCodeLine{02112\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{02113\ \}}
\DoxyCodeLine{02114\ }
\DoxyCodeLine{02115\ \}\ \ \textcolor{comment}{//\ namespace\ kiwi}}
\DoxyCodeLine{02116\ }
\DoxyCodeLine{02117\ KIWI\_POP\_WARNING}

\end{DoxyCode}
